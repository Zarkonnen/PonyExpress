<!DOCTYPE html>
<html style="margin: 0; padding: 0;">
    <head>
        <title>Game</title>
        <script src="jquery-3.1.1.min.js"></script>
        <script src="howler.min.js"></script>
    </head>
    <body style="margin: 0; padding: 0; background: black;">
        <canvas width="800" height="600" allowfullscreen="true" id="gameCanvas" style="margin-left: 10px; margin-top: 10px;"></canvas>
        <script>

var streaks = [];

streaks.push({
    y: 0.3,
    h: 0.05,
    colors: ["rgba(249, 188, 16, 0.5", "#f9bc10", "white"],
    values: [],
    time: 0
});

streaks.push({
    y: 0.5,
    h: 0.06,
    colors: ["rgba(0, 172, 175, 0.5", "#00acaf", "white"],
    values: [],
    time: 0
});

const numValues = 20;
const speed = 1.5;
var time = 0;

function tick(ms) {
    const w = canvas.width;
    const h = canvas.height;
    c.resetTransform();
    
    time += ms;
    
    var fr = Math.floor(249 * (Math.sin(time * 0.001) * 0.5 + 0.25) / 2);
    var fg = Math.floor(188 * (Math.sin(time * 0.001) * 0.5 + 0.25) / 2 + 172 * (Math.cos(time * 0.002) * 0.5 + 0.25) / 2);
    var fb = Math.floor(16 * (Math.sin(time * 0.001) * 0.5 + 0.25) / 2 + 175 * (Math.cos(time * 0.002) * 0.5 + 0.25) / 2);
    
    c.fillStyle = "rgb(" + fr + ", " + fg + ", " + fb + ")";
    
    console.log(c.fillStyle);
    c.fillRect(0, 0, w, h);
    
    for (s of streaks) {
        s.time += ms;
        if (s.time > 1000 / numValues / speed) {
            s.time -= 1000 / numValues / speed;
            if (s.values.length > numValues + 1) {
                s.values.splice(0, 1);
            }
            s.values.push((Math.random() * 0.5 + 0.5) * s.h);
        }
        var streakHDiv = 1;
        for (color of s.colors) {
            c.fillStyle = color;
            c.beginPath();
            var streakX = w * ((numValues + 2.0) / numValues - s.time / 1000.0 * speed);
            c.moveTo(streakX, h * s.y);
            for (var i = s.values.length - 1; i >= 0; i--) {
                streakX -= w * 1.0 / numValues;
                c.lineTo(streakX, h * (s.y + s.values[i] / streakHDiv));
            }
            streakX -= w * 1.0 / numValues;
            c.lineTo(streakX, h * s.y);
            for (var i = 0; i < s.values.length; i++) {
                streakX += w * 1.0 / numValues;
                c.lineTo(streakX, h * (s.y - s.values[i] / streakHDiv));
            }
            c.closePath();
            c.fill();
            streakHDiv++;
        }
    }
}


function hwl(name, volume) {
    return new Howl({src: ["sounds/" + name + ".ogg", "sounds/" + name + ".mp3", "sounds/" + name + ".wav"], volume: volume || 1});
}

var images = {};

function img(img, x, y) {
    if (img == null) { return; }
    if (!images[img]) {
        images[img] = new Image();
        images[img].src = "graphics/" + img + ".png";
    }
    c.drawImage(img, x, y);
}

var canvas = document.getElementById("gameCanvas");
var c = canvas.getContext("2d");
var keys = {};
var keyCodes = {};
var click = null;
var mouseDown = false;
var cursor = {x: 300, y: 300};

// Listen for key presses.
function canvasKeyUp(e) {
    keyCodes[e.which] = true;
    keys[String.fromCharCode(e.which)] = true;
}

function pressed(key) {
    return !!keys[key] || !!keyCodes[key];
}

$('body').keyup(canvasKeyUp);

// Listen for mouse stuff.
function canvasClick(e) {
    click = { "x": e.offsetX, "y": e.offsetY };
}

function canvasMouseDown(e) {
    mouseDown = true;
}

function canvasMouseUp(e) {
    mouseDown = false;
}

function canvasMove(e) {
    cursor = { "x": e.offsetX, "y": e.offsetY };
}

$('#gameCanvas').click(canvasClick).mousemove(canvasMove).mousedown(canvasMouseDown).mouseup(canvasMouseUp);

// Set up game loop.
var requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame || window.msRequestAnimationFrame;
var lastUpdate = new Date().getTime();

function nextFrame() {
    var currentTime = new Date().getTime();
    tick(currentTime - lastUpdate);
    keys = {};
    keyCodes = {};
    click = null;
    lastUpdate = currentTime;
    requestAnimationFrame(nextFrame);
}

// Once everything is set up, start game loop.
requestAnimationFrame(nextFrame);

jQuery(window).resize(function() {
    canvas.width = window.innerWidth - 20;
    canvas.height = window.innerHeight - 20;
});
jQuery(window).ready(function() {
    canvas.width = window.innerWidth - 20;
    canvas.height = window.innerHeight - 20;
});
 
/*canvas.addEventListener("click", function() {
    if (canvas.webkitRequestFullScreen) {
        canvas.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT);
    } else if (canvas.mozRequestFullScreen) {
        canvas.mozRequestFullScreen();
    } else if (canvas.requestFullScreen) {
        canvas.requestFullScreen();
    }
});*/
        </script>
    </body>
</html>
